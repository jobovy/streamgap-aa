\documentclass[useAMS,usenatbib,fleqn,a4paper]{mn2e}
\usepackage{times}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{bmpsize}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{paralist}
\usepackage{mathrsfs}
\usepackage{booktabs}
\usepackage{tabularx}

\def\df{{\sc df}}
\def\edf{{\sc edf}}
\def\feh{{\rm [Fe/H]}}
\def\afe{[\alpha/{\rm Fe}]}
\def\aFe{[\alpha/{\rm Fe}]}
\def\meh{{\rm [M/H]}}
\def\zd{z_d}
\def\dex{\,{\rm dex}}
\def\d{{\rm d}}
\def\rc{R_{\rm c}}
\def\rd{R_{\rm d}}
\def\rs{R_\sigma}
\def\Fh{F_{\rm h}}
\def\fracj#1#2{{\textstyle\frac#1#2}}
\def\i{{\rm i}}
\def\aj{AJ}
\def\apj{ApJ}
\def\apjl{ApJL}
\def\apjs{ApJS}
\def\mnras{MNRAS}
\def\aap{A \& A}
\def\kpc{\,{\rm kpc}}
\def\mas{\,{\rm mas}}
\def\pc{\,{\rm pc}}
\def\kpcMyr{\,{\rm kpc\,Myr^{-1}}}
\def\masyr{\,{\rm mas\,yr^{-1}}}
\def\kms{\,{\rm km\,s^{-1}}}
\def\rad{\,\rm rad}
\def\Gyr{\,{\rm Gyr}}
\def\Myr{\,{\rm Myr}}
\def\ActionUnits{\,{\rm kpc^{2}Myr^{-1}}}
\def\percent{\text{ per cent}}
\def\half{{\textstyle{\frac12}}}
\def\pa{\partial}

\newcommand{\bs}[1]{\bmath{#1}}
\newcommand{\mat}[1]{\mathbfss{#1}}
\def\percent{\text{ per cent}}
\newcommand{\e}{\mathrm{e}}
\newcommand{\vJ}{\bs{J}}\newcommand{\vx}{\bs{x}}
\newcommand{\vy}{\bs{y}}\newcommand{\vv}{\bs{v}}
\newcommand{\vD}{\bs{D}}

\title{General framework for stream gap formation I}
\pagerange{\pageref{firstpage}--\pageref{lastpage}} \pubyear{2015}

\begin{document}
\maketitle
\label{firstpage}
\begin{abstract}
We develop a formalism for modelling the impact of dark matter sub-halos on cold thin streams. Our formalism models the formation of a gap in the stream in angle-frequency space and is able to handle general stream and impact geometry. We analyse a single simulation in angle-frequency space and demonstrate that our formalism is able to predict the gap properties at a range of times. We show how the results in angle-frequency space can be related to physical properties of the gaps and that previous results for more constrained simulations are recovered.

We demonstrate how our results are dependent upon the mass of the sub-halo and the location of the impact along the stream. We find that gaps formed far downstream grow more rapidly than those closer to the progenitor due to the ordered nature of the stream. Additionally, we find that the minimum gap density plateaus in time at a value that decreases with increasing sub-halo mass.

We provide general expressions for the velocity perturbations due to the fly-by of a Plummer and a Hernquist sphere.
\end{abstract}

\begin{keywords}
\end{keywords}

\section{Introduction}

One of the key predictions of the currently favoured $\Lambda$CDM cosmology is hierarchical structure formation. Early in the Universe dark matter overdensities formed, began accumulating baryons and conglomerating into ever larger dark matter haloes. The result of this process is that at the current time within a large dark matter halo such as that of the Milky Way there are many smaller dark matter haloes. Current simulations (REFS) predict there are a spectrum of these sub-haloes. 

From an observational point-of-view the nature of dark matter has remained aloof as direct detection has proved fruitless. The other crucial line of attack is probing the gravitational effects of dark matter on both visible matter and photons on astrophysical scales. The large-scale smooth dark matter halo is being mapped out with dynamical models of both the assumed phase-mixed components of the Galaxy (e.g. the disc REF and the stellar halo REF) and those components of the Galaxy that are yet to fully phase mix (e.g. tidal streams REF). Tidal streams are filaments of material stripped from satellites of a host Galaxy and are naturally a result of the hierachical structure formation picture. Some streams (e.g. GD-1) are observed to be very kinematically cold such that, in addition to being probes of the large-scale dark matter structure, they are very sensitive probes of interactions with the dark matter sub-haloes. Interactions between streams and dark matter haloes produce gaps in the streams that grow over time. A conclusive detection of one such a gap would be very powerful evidence for $\Lambda$CDM cosmology, whilst the ultimate goal might be to measure the dark-matter halo mass spectrum from a whole series of observed gaps.

To achieve this ambitious goal we need a concerted modelling effort to understand the structure of a gap in a stream. The goal is doubly ambitious due to the difficulties that modelling unperturbed streams has presented. The modelling of streams has received considerable attention in the literature and there have been many proposed methodolgies for measuring the Galactic potential using streams (REF). However, there have been very few successful applications to the data (REFS) and we have not yet reached a point where modelling a stream is simple. One very powerful method is to construct models of streams in angle-frequency space as proposed by \cite{Bovy2014} and \cite{Sanders2014}. This space simplifies the stream dynamics \citep{HelmiWhite1999,Tremaine1999} and allows rapid generation of general stream models.

In recent years there has been much progress made in understanding the structure of stream gaps through the analysis of numerical simulations (REFS) as well as through analytic approaches (REFS). The analytic approaches have relied heavily on the simplicity with which circular orbits can be handled. Unfortunately, by their nature tidal streams are on more eccentric orbits such that these approaches, whilst providing useful insight, seem too simplistic to tackle any data. In this paper we will build on the angle-frequecny stream formalism and argue that it provides a clear basis on which to incorporate perturbations due to sub-halo fly-bys. We show that many of the insights from circular orbits can be extended to general, eccentric orbits. We work from the point-of-view that we know the underlying unperturbed stream model well and we are trying to characterise substructure in the stream. 

We will show how one can compute the kicks in velocity, angles and frequencies for general sub-halos and general impact geometries. We provide analytic forms for the computation of the kicks in velocity for both Plummer and Hernquist sub-halos. With the aid of a simulation of a cold stream on an eccentric orbit in a flattened axisymmetric logarithmic potential we demonstrate how an perturbed stream model can be generated and we inspect the resultant distributions in action, angle and frequency space. We show that a gap forms in angle, frequency and action space and that the gap size in the parallel angle space (the angle along the stream) grows like the spatial gap size. We simulate a series of halo fly-bys of differing masses and geometry. We find in all cases the minimum density in the gap plateaus in time and that the gap size grows fastest for fly-bys far from the stream progenitor where the particles are well ordered by energy.

The paper is arranged as followed. We begin in Section~\ref{Sect::Formalism} with the framework for computing the perturbation of a stream due to a general sub-halo fly-by. In Section~\ref{Sect::Simulation} we detail a simulation of a $10^8M_\odot$ dark matter impact on a cold stream formed from a progenitor on an eccentric orbit. We apply the framework of Section~\ref{Sect::Formalism} to understand the structure of the simulation and show we are able to reliably simulate the fly-by. In Section~\ref{Sect::Variation} we simulate fly-bys of varying sub-halo masses and varying impact geometry. We discuss the applicability of our formalism in Section~\ref{Sect::Discussion} before closing with our conclusions in Section~\ref{Sect::Conclusions}. In Appendix~\ref{Sect::Appendix} we give some details of the calculation of angles, actions and frequencies.

\section{Formalism}\label{Sect::Formalism}
\subsection{Velocity kicks}
In this section we give expressions for the velocity changes of stream particles under the influence of a sub-halo fly-by. Following both \cite{YoonJohnstonHogg} and \cite{ErkalBelokurov2015} we work under the impulse approximation i.e. the integrated acceleration is assumed to act instantaneously at some impact time such that the velocity of the stream particles changes instantly. The change in velocity is given by
\begin{equation}
\delta\bs{v} = \int_{-\infty}^{\infty} \d t\,\bs{a},
\end{equation}
where $\bs{a}$ is the acceleration due to the sub-halo\footnote{Throughout this paper we use $\delta$ to denote changes in quantities for individual particles in time e.g. from the sub-halo fly-bys, and $\Delta$ for differences \emph{between} particles.}. The fly-by is described by the impact parameter $b$, the velocity of the sub-halo $\bs{w}$ and the time of the impact $t=-t_g$. To simplify the following expressions we set $t_g=0$. \cite{ErkalBelokurov2015} gave expressions for the velocity kicks due to a Plummer sub-halo on a straight stream segment moving at a fixed relative velocity to the sub-halo. This formulation produced simple analytic results. Here we will give more general formulae for the velocity kicks.

We expand on the formalism of \cite{ErkalBelokurov2015} by explicitly considering the spatial distribution of the stream. We retain the simplification that each particle moves at a fixed relative velocity to the sub-halo during the fly-by. We define the phase-space coordinates of the stream particles as $(\bs{x}_i,\bs{v}_i)$ and the stream point of closest approach as $(\bs{x}_0,\bs{v}_0)$. The vector of closest approach is given by
\begin{equation}
\bs{b}_0=b\frac{\bs{w}\times\bs{v}_0}{|\bs{w}\times\bs{v}_0|}.
\end{equation}
Note the sign of $b$ is important in defining the curvature of the stream relative to the sub-halo. We define
\begin{equation}
\bs{b}_i = \bs{b}_0+\bs{x}_i-\bs{x}_0
\end{equation}
as the displacement vector between stream particle $i$ and the sub-halo at the impact time, and
\begin{equation}
\bs{w}_i=\bs{w}-\bs{v}_i
\end{equation}
as the corresponding relative velocity. The expression for the velocity kicks for the $i$th stream particle is given by
\begin{equation}
\delta\bs{v}^g_i = \int_{-\infty}^{\infty} \d t\,\bs{a}(\bs{b}_i+\bs{w}_it).
\end{equation}For general sub-halo acceleration fields this integral must be calculated numerically via a coordinate transformation to make the limits finite. However, for both a Plummer sub-halo and a Hernquist sub-halo the velocity kicks may be computed analytically. The potential of a Plummer sphere is given by
\begin{equation}
\Phi_{\rm P}(r) = -\frac{GM}{\sqrt{r^2+r_s^2}},
\end{equation}
where $M$ is the mass and $r_s$ the scale radius. The velocity kicks are given by
\begin{equation}
\delta\bs{v}^{g}_{i,\mathrm{P}} = -\frac{2GM}{|\bs{w}_i|}
\frac{\bs{b}_i-\hat{\bs{w}}_i(\bs{b}_i\cdot\hat{\bs{w}}_i)}
{(B^2+r_s^2)},
\label{curved}
\end{equation}
where
\begin{equation}
B^2=|\bs{b}_i|^2
-|\bs{b}_i\cdot\hat{\bs{w}}_i|^2.
\end{equation}
In Fig.~\ref{curved_straight} we show a comparison between the kicks calculated using this expression and the kicks calculated assuming the stream is a straight-line segment as in \cite{ErkalBelokurov2015}. The stream is a circular orbit at $10\kpc$ with a circular velocity of $220\kms$ impacted by a Plummer sphere of velocity $\bs{w}=(0,132,176)\kms$ and impact parameter $b=r_s$. We show two kicks: one due to a sub-halo of mass $10^8M_\odot$ and scale radius $r_s=625\pc$ and one due to a sub-halo of mass $10^7M_\odot$ and scale radius $r_s=250\pc$. The distance along the stream in the straight-line approximation is calculated as $\Delta\phi\times10\kpc$. The differences are small with the $v_z$ kicks being the largest. We also show $\bs{v}\cdot\delta\bs{v}^g$ which is very similar for the two cases. As we will see later it is this quantity which has the largest effect on the future structure of the stream. For our calculations in Section~\ref{Sect::simulation} we will use equation~\eqref{curved} to calculate all kicks.

The potential of a Hernquist sphere \citep{Hernquist1990} is given by
\begin{equation}
\Phi_{\rm H}(r) = -\frac{GM}{r+r_s},
\end{equation}
where $M$ is the mass and $r_s$ the scale radius. The velocity kicks are given by
\begin{equation}
\delta\bs{v}^{g}_{i,\mathrm{H}} = = -\frac{2GM}{|\bs{w}_i|}
\frac{\bs{b}_i-\hat{\bs{w}}_i(\bs{b}_i\cdot\hat{\bs{w}}_i)}
{(B^2-r_s^2)}\Big(1-\frac{2r_s}{r_s+B}X(S)\Big),
\label{curved_hernquist}
\end{equation}
where
\begin{equation}
S=\sqrt{\frac{2B}{r_s+B}},
\end{equation}
and we have made use of the function $X(s)$ introduced in equation (33) and (34) of \cite{Hernquist1990} which is given by
\begin{equation}
X(s)=\begin{cases}
    \frac{1}{\sqrt{1-s^2}}\mathrm{arcsech}\,s,& 0\leq s\leq 1\\
    \frac{1}{\sqrt{s^2-1}}\mathrm{arcsec}\,s, & 1\leq s\leq \infty.
\end{cases}
\end{equation}
We note the form is very similar to the Plummer kicks and, as required, the two are equal when $r_s\rightarrow0$.

\begin{figure*}
$$\includegraphics[width=\textwidth]{curved_straight_comparison}$$
\caption{
A comparison of the velocity kicks calculated assuming a straight stream track and using the true stream geometry. The stream track is a circular orbit of radius $10\kpc$ and circular velocity $220\kms$ and is shown in black in the left panel. TWo lines are shown in the second through to fifth panel corresponding to two sub-halos, which are each a Plummer sphere moving at $\bs{w}=(0,132,176)\kms$ with an impact parameter $b=r_s$. The higher amplitude kicks correspond to the sphere of mass $10^8M_\odot$ and scale radius $r_s=625\pc$ and the lower amplitude kicks correspond to the sphere of mass $10^7M_\odot$ and scale radius $r_s=250\pc$. The red arrow shows the projection of the velocity vector into the plane. The second, third and fourth plots show the velocity kicks as a function of the azimuthal angle from the centre of the galaxy. The black lines show the kicks calculated using equation~\protect\eqref{curved} whilst the red dashed lines show the kicks computed assuming the stream is a straight line segment along the $y$-axis. The rightmost panel shows $\bs{v}\cdot\delta\bs{v}^g$. The dotted blue lines show the angles at which the projection of the velocity vector of the sub-halo intersects the stream.
}
\label{curved_straight}
\end{figure*}

We also consider kicks due to truncated Navarro-Frenk-White profiles. The density profile for these halos is given by
\begin{equation}
\rho_{\rm NFW}(r) = \frac{M}{4\pi r_s^3}\Big(\frac{r}{r_s}\Big)^{-1}\Big(1+\frac{r}{r_s}\Big)^{-2}\mathrm{sech}\Big(\frac{r}{r_t}\Big).
\end{equation}
$r_t$ is the truncation radius. For non-zero $r_t$ the forces and potential must be computed numerically and clearly for $r_t\rightarrow\infty$ the form reduces to the well-known NFW profile. In Fig.~\eqref{plummer_nfw} we show the kicks computed for a Plummer sub-halo, a Hernquist sub-halo, a NFW sub-halo and truncated NFW sub-halo. We also show $\bs{v}\cdot\Delta\bs{v}$ which is the quantity that controls the future structure of the stream. We have assumed the stream is a straight-line segment moving along the $y$ axis at velocity $v_y=2$. The Plummer sub-halo has $GM=2$, scale-radius $r_s=2$, impact parameter $b=\sqrt{3}$ and velocity $\bs{w}=(0.6,1.2,0)$. The other three haloes have the same mass parameter as the Plummer sphere. The Hernquist and NFW haloes have scale radii chosen such that the mass contained within the Plummer scale radius is identical to the Plummer case. The truncated NFW profile has a scale radius equal to that of the Plummer sphere and has a truncation radius of $r_t=2$. The NFW profile is more spatially extended so the amplitude of the kicks are larger than the Plummer kicks at large distances from the impact. When the NFW profile is truncated the velocity kicks are very similar to the Plummer kicks. The Hernquist profile produces similar shaped kicks to the Plummer and truncated NFW but the amplitude is slightly smaller.

\begin{figure*}
$$\includegraphics[width=\textwidth]{nfw_plummer_comparison}$$
\caption{
A comparison of the velocity kicks from a Plummer, a Hernquist, a NFW and a truncated NFW sub-halo. The left panel shows the density and mass profiles of the four haloes. All four haloes have the same mass parameter. The Hernquist and NFW scale radii are chosen such that at the Plummer scale radius ($r_s$) the same mass is enclosed by the profiles. The truncated NFW halo has a scale radius equal to that of the Plummer sphere and a truncation radius of $2r_s$. The mass profiles for the four haloes are shown in the lower left panel. The second, third and fourth panels show the velocity kicks as a function of the distance along the stream. The rightmost panel shows $\bs{v}\cdot\delta\bs{v}^g$. The stream is a particle train along the $y$-axis with velocity $2$. The sub-haloes have $GM=2$, $r_{s,\mathrm{Plummer}}=2,r_{s,\mathrm{NFW}}=1.21$
, impact parameter $b=\sqrt{3}$ and velocity $\bs{w}=(0.6,1.2,0)$. The velocity kicks have approximately the same amplitude and the key difference is the velocity kicks due to the NFW halo fall off more slowly with $|y|$ as the NFW halo is more spatially extended.
}
\label{plummer_nfw}
\end{figure*}

\subsection{Angle-frequency kicks}\label{Sec::Formalism_angfreq}
\cite{ErkalBelokurov2015} gave analytic results for the structure of a gap as a function of time for streams on circular orbits. Such an approach is fruitful for developing an understanding of the gap formation but when modelling realistic streams we require a formalism that is appropriate for eccentric orbits. Dynamical systems are often simplified through the use of angle-actions coordinates $(\bs{J},\btheta)$. These canonical coordinates possess the properties that the actions are integrals of motion whilst the angles increase linearly with time at a rate $\boldsymbol{\Omega}$, which are the frequencies. The equations of motion for the angle-action coordinates are
\begin{equation}
\begin{split}
\bs{J}&=\mathrm{const},\\
\btheta&=\frac{\partial H}{\partial\boldsymbol{J}}t+\btheta(0)=\boldsymbol{\Omega}t+\btheta(0),
\end{split}
\end{equation}
where $t$ is the time and $\btheta(0)$ is the angle at $t=0$. In axisymmetric potentials\footnote{In this paper we will only work with axisymmetric potentials but the formalism is simply extended to more general potentials.} the three actions are given by $\bs{J}=(J_R,L_z,J_z)$. $J_R$ is the radial action describing the extent of the radial oscillations, $J_z$ is the vertical action describing the extent of the vertical oscillations and $L_z$ is the $z$-component of the angular momentum. To compute the actions, angles and frequencies in this paper we use the method of \cite{SandersBinney2014}. This method uses a generating function to transform from a set of toy angle-action variables (computed in an isochrone potential) to the target set. The coefficients of the generating function (Fourier components $S_{\bs{n}}$ and their derivatives) are found from a least-squares fit to a series of phase-space samples from an orbit integration.

\cite{HelmiWhite1999} and \cite{Tremaine1999} both discussed the evolution of a stream as a small action clump in angle-actions, which was built on by the work of \cite{EyreBinney2011}. \cite{SandersBinney2013b} presented the idea that the angle-frequency distribution could be used as a probe of the galactic potential. These ideas were extended by both \cite{Bovy2014} and \cite{Sanders2014} who developed generative models for streams in angle-frequency space. This framework is ideal for the introduction of velocity perturbations due to a sub-halo.

Each particle in a stream obeys the equation
\begin{equation}
\Delta\bs{\theta} = \btheta-\btheta_0 = (\boldsymbol{\Omega}-\boldsymbol{\Omega}_0)t_s +\Delta\bs{\theta}_\mathrm{init}= \Delta\bs{\Omega}_\mathrm{init}t_s,
\end{equation}
where the subscript $0$ denotes the coordinates of the progenitor, $\Delta$ denotes separation between the progenitor and a stream particle and $\mathrm{init}$ denotes the separation between progenitor and particle at release and $t_s$ is the time since the particle was stripped.

A long thin stream is characterised by a vector $\bs{n}$ along which the particles lie in both angle and frequency space. This vector is the principal eigenvector of the Hessian matrix $D_{ij}=\partial^2 H/\partial J_i\partial J_j$. Note that if the frequencies are functions solely of the Hamiltonian (as in the Kepler case) $\bs{n}$ is aligned with the stream particle frequency vectors and the stream is well approximately by an orbit. We will return to this point later. \cite{Bovy2014} and \cite{Sanders2014} introduced a model for each tail of the stream (leading or trailing) in angle-frequency space that was an elongated Gaussian in the frequency offset from the progenitor and a isotropic Gaussian in initial angle offset from the progenitor. By estimating some stripping rate $p(t)$ the angle-frequency distribution could be calculated at all times. Through the introduction of a linear transformation from position-velocity space to angle-frequency space in the neighbourhood of the stream, \cite{Bovy2014} demonstrated that the stream model could be rapidly sampled at any time.

The angle-frequency model of a stream can be simply extended to include the effects of a gap. Under the impulse approximation of the previous section we can calculate the change to the angles and frequencies for small velocity kicks as
\begin{equation}
\begin{split}
\delta \boldsymbol{\Omega}^g &= \frac{\upartial \boldsymbol{\Omega}}{\upartial \bs{v}}\Big|_{\bs{x}}\cdot \delta\bs{v},\\
\delta \bs{\theta}^g &= \frac{\upartial \bs{\theta}}{\upartial \bs{v}}\Big|_{\bs{x}}\cdot \delta\bs{v}.
\end{split}
\end{equation}
The stream stretches along the direction $\bs{n}$ and in each tail the frequency distribution is very narrow such that, at a fixed time, the location of the particles in the stream are well approximated by a single angle coordinate $\theta_{||}=\btheta\cdot\bs{n}$. We assume that the kicks are functions of this single variable. If the kick occurred a time $t_g$ ago the angles and frequencies of a stream particle are given by
\begin{equation}
\begin{split}
\Delta\bs{\theta} &= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}(t_s-t_g)+\delta\bs{\theta}^g+(\Delta\boldsymbol{\Omega}_{\rm init}+\delta\boldsymbol{\Omega}^g)t_g \\&= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}t_s+\delta\bs{\theta}^g+\delta\boldsymbol{\Omega}^g t_g.
\end{split}
\end{equation}
The particle moves with its initial frequency separation until the kick at which point the particle continues to move at the initial frequency separation plus the frequency kicks.

The matrices $\frac{\upartial \bs{\theta}}{\upartial \bs{v}}\Big|_{\bs{x}}$ and $\frac{\upartial \bs{\Omega}}{\upartial \bs{v}}\Big|_{\bs{x}}$ must be calculated numerically. However, we will demonstrate that there are several approximate analytic relations that hold well for the inspected simulation.

\section{Simulation}\label{Sect::Simulation}
We use two simulations to investigate the formation of stream gaps in actions, angles and frequencies. Here we describe the set-up of the simulations. The stream progenitor is a King profile globular cluster with $W_0=5$, a mass of $10^5 M_\odot$ and a core radius of $r_c=13\pc$. The cluster was modelled with $10^6$ particles and a smoothing length of $1\pc$.
The galactic potential was modelled as a logarithmic halo of the form
\begin{equation}
\Phi_\mathrm{L}(R,z) = \frac{V_c^2}{2}\log\Big(R^2+\frac{z^2}{q^2}\Big),
\end{equation}
with $V_c = 220\kms$ and $q = 0.9$. The cluster was placed on an eccentric orbit with a pericentre of $15\kpc$ and apocentre of $30\kpc$, and the cluster was released around apocentre at $(30,0,0)\kpc$ with an initial velocity of $(0, 105.75, 105.75)\kms$. Both simulations were run for $10\Gyr$ and the stream was then impacted with a Plummer sub-halo of mass $10^8M_\odot$ and scale radius $r_s=625\pc$. The impact point was near pericentre with a impact parameter of $b=0$ and the velocity is perpendicular to the stream plane at this point with magnitude of $200\kms$. The sub-halo was inserted into the simulation $100\Myr$ before impact and removed $100\Myr$ after impact. The simulation was then evolved for a further $5\Gyr$. The simulation was run using \textsc{Gadget}. In Figure~\ref{GapDiagram} we show the full stream in the $(x,y)$ plane and a zoom-in of the gap centre at $880\Myr$ after impact.

\begin{figure}
$$\includegraphics[width=\columnwidth]{tilted_gap_morphology}$$
\caption{
Real-space distribution of stream and gap zoom-in.
}
\label{GapDiagram}
\end{figure}

\subsection{Action, angle \& frequency structure}
Here we investigate the angle, action and frequency structure of the stream. We take the snapshot of the stream at $880\Myr$ after impact and compute the angles, frequencies and actions for all particles in the trailing stream tail (defined by a spatial cut). We also perform the same calculation for the stream evolved without a sub-halo flyby. In Fig.~\ref{tilted_diff_map} we show histograms of the difference in the density in angle, frequency and action space between the perturbed and unperturbed simulation. We plot all quantities with respect to the coordinates of the gap centre which is defined by eye. In the angle and frequency distributions there is a clear under-density along the stream direction. In action space we also observe an under-density at the centre of the distributions but the exact geometry of the under and over-densities is complex and clearly depends on the nature of the stream track and sub-halo properties. We will discuss this further later.

% \begin{figure}
% $$\includegraphics[width=\columnwidth]{diff_map}$$
% \caption{
% Difference histograms between the unperturbed and perturbed streams for the $J_z=0$ progenitor with respect to the gap centre. The left panel shows the distribution in angles, middle panel frequencies and right panel actions.
% }
% \label{diff_map}
% \end{figure}

\begin{figure*}
$$\includegraphics[width=\textwidth]{tilted_diff_map}$$
\caption{
Difference histograms between the unperturbed and perturbed streams: the left panel shows the distribution in angles, middle panel frequencies and right panel actions. Zero-points correspond to the gap centre (defined by eye).
}
\label{tilted_diff_map}
\end{figure*}

In Figure~\ref{angfreq_dist} we plot the angles and frequencies for unperturbed and perturbed trailing stream distributions. The unperturbed simulation consists of a spur due to each stripping event. The material stripped in each event forms an approximately vertical line in this space before gradually twisting clockwise as the differential frequency effects take hold. The material on the far left was stripped earliest. We see that the sub-halo produces the expected S-shape which also twists clockwise in time due to the differential frequency effects. At $t=0$ there is a clear gap in frequency but only a relatively modest gap in angle. However, the twisting produces a gap in frequencies. The twisting also causes some perturbed material to overtake the unperturbed material.

\begin{figure}
$$\includegraphics[width=\columnwidth]{ang_freq_dists}$$
\caption{
Frequency-angle distributions for unperturbed (black) and perturbed (red) trailing tail at three different times. The three columns show the radial, azimuthal and vertical quantities.
}
\label{angfreq_dist}
\end{figure}

\subsection{Kicks}
In Section~\ref{Sec::Formalism_angfreq} we described how the angle and frequency kicks due to a sub-halo can be computed under a linear approximation from the velocity kicks. Here we use the expressions and compare the resulting kicks with those measured from the simulation.

We begin by taking the snapshot of the unperturbed stream at the impact time and form a stream track by fitting a spline to the stream particles. We then compute the vector $\bs{n}$ from this track and at each point along the stream track compute $\theta_{||}=\btheta\cdot\bs{n}$ as well as $\delta\bs{\Omega}^g(\theta_{||})$ and $\delta\bs{\theta}^g(\theta_{||})$ by finite differencing in velocity at fixed position. We show the resultant kicks in Fig.~\ref{kicks_nzero}. We also show the angle and frequency kicks computed from the simulation. In the case of the frequency kicks we simply difference the perturbed and unperturbed simulation. In the case of the angles we must calculate the angles and frequencies of the perturbed simulation and rewind to the impact point before differencing with the unperturbed snapshot. Note the match is satisfactory and for both examples the angle kick dominates on time-scales $\sim100\Myr$ whilst the frequency kicks dominate beyond this.

% \begin{figure}
% $$\includegraphics[width=\columnwidth]{angfreq_kicks.png}$$
% \caption{
% Angle and frequency kicks for the $J_z=0$ progenitor stream. The points show the kicks found from the simulations whilst the lines show those calculated under the impulse approximation.
% }
% \label{kicks_zero}
% \end{figure}

\begin{figure*}
$$\includegraphics[width=\textwidth]{tilted_angfreq_kicks.png}$$
\caption{
Angle and frequency kicks: the points are a random sample of $1000$ particles from the stream and show the kicks found from the simulations whilst the lines show those calculated under the impulse approximation.
}
\label{kicks_nzero}
\end{figure*}

\subsection{Model-simulation comparison}
With the angle and frequency kicks satisfactorily calculated we proceed to take the unperturbed simulation, apply the kicks and compare with the perturbed simulation at later times.

In Fig.~\ref{model_nzero} we show the angle and frequency distributions of the unperturbed simulation, the perturbed simulation and our model constructed by perturbing the angles and frequencies of the unperturbed simulation for the  stream after $880\Myr$. The match is very good and there is a clear gap in both angle and frequency.

% \begin{figure}
% $$\includegraphics[width=\columnwidth]{model_perturbed}$$
% \caption{
% Unperturbed, perturbed and model stream for the $J_z=0$ progenitor. The red histograms show the unperturbed stream at the current time, the green show the perturbed stream and the blue show the unperturbed stream kicked in angle and frequency space and evolved to the current time.
% }
% \label{model_zero}
% \end{figure}

\begin{figure*}
$$\includegraphics[width=\textwidth]{tilted_model_perturbed}$$
\caption{
Unperturbed, perturbed and model stream: the red histograms show the unperturbed stream at the current time, the green show the perturbed stream and the blue show the unperturbed stream kicked in angle and frequency space and evolved to the current time.
}
\label{model_nzero}
\end{figure*}

\begin{figure}
$$\includegraphics[width=\columnwidth]{ang_later_times}$$
\caption{
Unperturbed, perturbed and model stream: the red histograms show the unperturbed stream, the green show the perturbed stream and the blue show the unperturbed stream kicked in angle and frequency space and evolved. The purple line shows the difference between the perturbed and unperturbed streams offset by some arbitrary amount. The four rows show $0,0.88,3$ and $5\Gyr$ after impact.
}
\end{figure}

\subsection{Analytic approximations}
We now develop some understanding of the magnitude of the angle, frequency and action kicks by inspecting some cases where we can calculate these quantities analytically.

For scale-free potentials of the form $\Phi\propto r^\alpha$ \cite{WilliamsEvans2014} demonstrated that the Hamiltonian in action-space is well approximated by
\begin{equation}
H(\bs{J}) \propto (J_R+B L)^\beta,
\end{equation}
where $\beta=2\alpha/(2+\alpha)$, $B$ is a constant and $L$ is the angular momentum. They also suggest that in scale-free flattened axisymmetric potentials of the form $\Phi\propto (R^2+(z/q)^2)^{\alpha/2}$ the Hamiltonian is well approximated by
\begin{equation}
H(\bs{J}) \propto (J_R+B L_z+CJ_z)^\beta,
\end{equation}
where $B$ and $C$ are constants.
In these potentials the frequencies are solely functions of the Hamiltonian so we find that
\begin{equation}
\frac{\delta\Omega_i^g}{\Omega_i}=\frac{\beta-1}{\beta}\frac{\delta H}{H}.
\end{equation}
Note in the case of the harmonic oscillator $\beta=1$ and the right-hand side vanishes as the frequencies are energy independent. This equation can also be derived when considering the change in the energy and frequency of a circular orbit. The analogous approximate expression for the Hamiltonian in the scale-free logarithmic potential is
\begin{equation}
H(\bs{J}) = V_c^2\log(J_R+B L_z+C J_z)),
\end{equation}
such that
\begin{equation}
\frac{\delta\Omega_i^g}{\Omega_i}=-\frac{\delta H}{V_c^2}.
\label{dOm_an}
\end{equation}
In the case of a sub-halo flyby $\delta H^g=\bs{v}\cdot\delta\bs{v}^g$. We plot this approximation for the simulated stream in Fig.~\ref{analytic_freq}.
\begin{figure}
$$\includegraphics[width=\columnwidth]{analytic_freq}$$
\caption{
Analytic frequency kick approximation. The lines show the analytic relationship in equation~\protect\eqref{dOm_an} and the dots show the numerical calculation.
}
\label{analytic_freq}
\end{figure}

We would like to find analogous expressions for the actions and angles. We approximate the changes in the actions as
\begin{equation}
\begin{split}
\delta J^g_R &\approx \frac{\delta H^g - \Omega_\phi\delta L^g}{\Omega_R},\\
\delta L^g_z &\approx (\bs{r}\times\delta\bs{v}^g)_z,\\
\delta J^g_z &\approx \frac{v_z \delta v^g_z}{\Omega_z},
\end{split}
\label{dJ_an}
\end{equation}
where $\delta L = \bs{L}\cdot\delta\bs{L}^g/|\bs{L}|$ the change in the angular momentum. The change in $J_R$ comes from the spherical approximation and the change in $J_z$ from the assumption that it is a harmonic oscillator in the $z$ direction. We show these analytic approximations in Fig.~\ref{aa_nz} along with the kick distributions overlaid on the difference plots of Fig.~\ref{tilted_diff_map}. The analytic approximations recover the magnitude of the kicks within a factor of $\sim1.5$ but are not nearly as impressive as the frequency kick analytic expressions. These approximations work better for streams confined to the meridional plane. However, we see from the lower panels of Fig.~\ref{aa_nz} that the correlations between the action kicks are well recovered and explain the observed structure in the action difference plots. CAN WE SAY ANYTHNG MORE ABOUT THE CORRELATIONS?

Finally, we turn to the angle coordinates. From our investigations there don't appear to be any particularly neat or understandable analytic expressions we can derive for these quantities. However, from inspecting the harmonic oscillator (which is also appropriate for small oscillations about a circular orbit and perpendicular to the plane) we find that
\begin{equation}
\delta\theta^g_i\approx \frac{\delta\Omega^g_i x_i}{v_i}
\end{equation}
where $x_i$ and $v_i$ are the position coordinate relative to the minimum and the velocity coordinate of the $i^{\mathrm{th}}$ coordinate\footnote{There is an additional term due to the change in velocity which we have neglected assuming the velocity of the oscillations about a circular orbit are significantly smaller than the circular velocity.}. We see that when we are near a turning point ($v_i\approx0$) the angle kicks are largest and near the midpoints ($x_i\approx0$) the angle kicks are small. As expected the magnitude of the angle kicks are phase-dependent. These approximate expressions only recover the angle kicks from the simulation within a factor of $\sim2$.

% \begin{figure}
% $$\includegraphics[width=\columnwidth]{analytic_action}$$
% \caption{
% Analytic action kick approximation.
% }
% \label{aa_z}
% \end{figure}
\begin{figure*}
$$\includegraphics[width=\textwidth]{tilted_analytic_action}$$
\caption{
Analytic action kick approximation. In the top panels the red shows the approximate analytic expressions from equation~\protect\eqref{dJ_an} and the black is computed from the simulations. In the bottom panels we overlay the action kick distributions on the difference plots from Fig.~\protect\ref{tilted_diff_map}. Clearly the analytic approximation explains the correlations observed in the simulation.
}
\label{aa_nz}
\end{figure*}

\subsection{Stages of stream growth}
\cite{ErkalBelokurov2015} discussed the three phases of stream gap formation in the limit that the stream progenitor is on a circular orbit. They found that on short time-scales (less than a radial period) an overdensity formed as the particles were scattered onto epicyclic orbits that brought them towards the gap centre. This was dubbed the compression phase. After a radial period the stream enters an expansion phase where the gap begins growing until the perturbed material starts to overtake unperturbed material and a caustic forms. During the expansion phase the stream gap grows linearly in time whilst during the caustic phase the growth rate slows to $t^{1/2}$. In this section we investigate and discuss how this picture relates to the formalism presented here.

\begin{figure}
% $$\includegraphics[width=\columnwidth]{gap_size_planar}$$
$$\includegraphics[width=\columnwidth]{tilted_gap_size}$$
\caption{
Gap size in parallel angle as a function of time. The black line shows the gap measured from the simulation and the dashed red line shows the best fitting power-law line for $t<5\Gyr$. We also mark on the three phases of the gap growth from \protect\cite{ErkalBelokurov2015}.
}
\label{gap_size}
\end{figure}

In Fig.~\ref{gap_size} we plot the size of the gap in parallel angles as a function of time for the simulated stream. This is defined as the difference between the parallel angles of the points where the perturbed and unperturbed densities are equal. We also show a best-fit power-law line ($\Delta\theta_{||}\propto t^{0.58}$) for the segment $t<5\Gyr$ as well as the time-scales for the different stages of gap growth. The compression phase lasts for a single radial period. The time-scale on which the caustic becomes important is computed from equation (26) of \cite{ErkalBelokurov2015}. We note that in this example it only lasts for $\sim200\Myr$ but lowering the sub-halo mass to $10^7M_\odot$ increases the length of the expansion phase to $\sim600\Myr$. We note that there is a gap in parallel angle at $t=0$. This does not correspond to a spatial gap but is due to the angle kicks from the sub-halo that have shifted the stars to slightly different orbital phases. It is intriguing that the size of the initial gap in parallel angles is significantly larger than the peak of the angle kicks shown in Fig.~\ref{kicks_nzero}. However, one must consider the collective effects of a series of particles being kicked in order to compute the gap size. For instance, if the unperturbed parallel angle distribution $N_\mathrm{u}(\theta_{||})$ were a uniform distribution the perturbed distribution $N_\mathrm{p}(\theta_{||})$ would be given by
\begin{equation}
N_\mathrm{p}(\theta_{||})=\int \d\theta'_{||}\,N_\mathrm{u}(\theta'_{||})\delta(\theta_{||}-\theta'_{||}-\delta\theta^g_{||}(\theta'_{||}))\propto(1+\frac{\partial\delta\theta^g_{||}}{\partial\theta_{||}})^{-1}.
\end{equation}
The gap size is then related to the zeros of 
\[
\partial\delta\theta^g_{||}/\partial\theta^{\prime}_{||}
\]
and the peaks in the perturbed distribution are at the zeros of the second derivative
\[
\frac{\partial^2\delta\theta^g_{||}}{\partial\theta^{\prime2}_{||}}
\]
vanishes. In Fig.~\ref{secondderiv} we show the second derivative computed for our example as well as the quantity
\begin{equation}
(1+\frac{\partial\delta\theta^g_{||}}{\partial\theta_{||}})^{-1}-1.
\label{deriv}
\end{equation}
\begin{figure}
$$\includegraphics[width=\columnwidth]{d2dthetadtheta2}$$
\caption{
Derivatives of the parallel angle kicks: the solid blue line shows the second derivative of the kicks whilst the dotted red line shows the function of the first derivative that gives the density contrast for an initially uniform distribution in parallel angle space. The solid red line shows the scaled density contrast from the simulation. The black lines show the zero line and the approximation location of the peak density contrast.
}
\label{secondderiv}
\end{figure}

The second derivative is zero around $\delta\theta_{||}\approx0.16$ and equation~\eqref{deriv} crosses zero around $\delta\theta_{||}\approx0.1$. These correspond well to the observed initial amplitude of the parallel-angle gap size $(\sim0.2)$. We also show the density contrast computed from the simulations which correlates well with equation~\eqref{deriv}. Therefore, we conclude that there is not a one-to-one correspondence between the amplitude of the angle kicks and the initial parallel angle gap size, and the latter can be significantly greater than the former.

The initial angle kick appears to dominate on a time-scale of $\sim400\Myr$ after which the best-fit power-law is a much better match. This also appears to correlate with the end of the compression phase. Therefore, it seems that the compression phase is associated with the initial angle kicks. We can understand this by considering a simple example of a stream on a radial orbit. Here the parallel angle is purely the radial angle. The shape of the angle kicks will be very similar to those in Fig.~\ref{kicks_nzero} with the angles in front of the gap given a positive kick and those behind given a negative kick. At a fixed position increasing the radial angle means we are now closer to apocentre so the apocentre has moved inwards and the particle must move more slowly. Likewise decreasing the radial angle moves apocentre further out and the particle must move faster. Therefore, the particles behind the gap move faster than those in front and an overdensity forms.

We use the formulae from \cite{ErkalBelokurov2015} to calculate the time-scale on which the caustic begins to form. In this case the expansion phase is very short and so the subsequent evolution should go with the square-root of time. We see, however, that this is only approximately true up to $\sim4\Gyr$ (the best-fitting power law is $t^{0.58}$) after which the growth rate is faster than this. We will return to this point later and only mention here that it is due to the gap forming on an already growing underlying stream.

Our discussion has related to the size of the gap in parallel angle. Whilst this is an appropriate space for understanding general stream morphology it is awkward to see the relationship with the observed stream properties. We briefly investigate this by projecting the model back into real-space. For this purpose we use the publicly-available torus code from McMillan, Binney \& Dehnen (2015, in prep.). We construct eight tori on the corners of an action-space box that encompasses the full perturbed distributions and interpolate the frequencies to find the actions of the perturbed particles. We then interpolate the Fourier coefficients of the tori in action-space to construct a torus of the required actions for each particle and request the $(\bs{x},\bs{v})$ corresponding to the angles of the particle. We then find a plane that minimises the perpendicular spread of the stream and compute the size of the gap in the azimuthal angle in the plane in the same way as in parallel angle space. We plot both the azimuthal gap size and the parallel angle gap size as a function of time in Fig.~\ref{real_v_angle}. As expected the azimuthal gap size oscillates but it is well enveloped by the parallel angle gap size and it appears that the average azimuthal gap size correlates well with the parallel angle gap size. We note that the amplitude of the oscillations of the azimuthal gap size can be estimated by considering conservation of angular momentum. If two particles in the stream had identical angular momentum their azimuthal separation $\Delta\phi\sim r^{-2}$ such that the amplitude of the oscillations is $\sim(r_\mathrm{max}/r_\mathrm{min})^2$. For our simulation means the azimuthal separation fluctuates by a factor $\sim 4$, which agrees well with Fig.~\ref{real_v_angle}. We also can clearly see the gap forms immediately in parallel angle whilst in azimuthal angle there is a small peak due to the compression phase.

We also plot the minimum and maximum density contrasts (defined as perturbed divided by unperturbed density). The azimuthal density contrast oscillates about the parallel angle density contrast, and both plateau at late times ($t>4\Gyr$). \cite{ErkalBelokurov2015} showed that the minimum density contrast falls as $1/t$ and the maximum grows as $t$, which are well reproduced by our simulation.

\begin{figure}
$$\includegraphics[width=\columnwidth]{real_vs_angle_properties}$$
\caption{
Gap properties in real and angle space. In the top panel we show the gap size in the azimuthal angle of a plane fitted through the stream in solid black and the gap size in parallel angle in dashed red. In the bottom panel we show the minimum and maximum density contrast in these two spaces.
}
\label{real_v_angle}
\end{figure}

\section{Varying the impact properties}\label{Sect::Variation}
We have demonstrated that we are able to adequately model the impact of a sub-halo on a stream and the subsequent evolution. With this machinery in place we are able to rapidly simulate the effects of any sub-halo fly-by. In this section we will discuss the differences in the subsequent stream structure as a function of the sub-halo mass and the sub-halo impact location. We repeat the exercise performed in Section~\ref{Sect::Simulation} of simulating the sub-halo fly-by on a simulated unperturbed stream and inspecting the subsequent evolution.

\subsection{Varying the sub-halo mass}
First, we investigate the properties of the stream as a function of sub-halo mass. We adopt the scaling relation between the mass and scale radius of the sub-halo Plummer sphere of
\begin{equation}
M\propto r_s^{2.5}.
\end{equation}
Keeping all other properties of the sub-halo fly-by the same we simulate the effects of a $10^7M_\odot$ and $10^{7.5}M_\odot$ sub-halo. In Figure~\ref{varying_mass} we show the gap after $t=880\Myr$, the gap size as a function of time and the minimum and maximum density contrast as a function of time. As expected the gap size is deepest and grows fastest for the highest mass sub-halo. In all cases the minimum density contrast plateaus in time and the value that the density contrast plateaus to decreases with mass. It appears that empirically $\rho_\mathrm{min}/\rho_0\sim(M/r_s)^{-1}\sim M^{-0.6}$ such that there is a factor $4$ difference in depth between the $10^8M_\odot$ and $10^7M_\odot$ cases.

\begin{figure*}
% $$\includegraphics[width=\columnwidth]{gap_size_planar}$$
$$\includegraphics[width=\textwidth]{different_masses}$$
\caption{
Properties of the stream as a function of sub-halo mass. The thick brown line corresponds to $10^8M_\odot$, the medium red line $10^{7.5}M_\odot$ and the thin orange line $10^7M_\odot$. The left panel shows the difference between the perturbed and unperturbed simulations in parallel angle after $t=880\Myr$, the middle panel shows the gap size as a function of time and the right panel shows the minimum and maximum density contrast as a function of time.
}
\label{varying_mass}
\end{figure*}

\subsection{Varying the impact geometry}
Now we investigate how the stream changes as a function of where along the stream the impact occurs. In addition to the inspected geometry of Section~\ref{Sect::Simulation} we simulate an impact closer to the progenitor ($[x,y,z]=[-15.3,-9.8,9.3]\,\mathrm{kpc},[v_x,v_y,v_z]=[41.9,-183.0,152.2]\,\mathrm{km\,s}^{-1}$) and one further from the progenitor ($[x,y,z]=[-1.2,12.9,-10.8]\,\mathrm{kpc},\,[v_x,v_y,v_z]=[-239.8,-100.6,87.0]\,\mathrm{km\,s}^{-1}$). Again, we fix all other parameters of the impact to those in the original simulation, including the absolute velocity of the sub-halo (note that fixing the relative velocity between the sub-halo and impact point in the stream does not change the conclusions drawn here). In Fig.~\ref{varying_geometry} we plot the locations of these impacts in both real-space (the $(x,y)$ plane) and in parallel angles. The near impact is in the regime where the mean parallel frequency is approximately constant with the parallel angle whilst the far impact is in the regime where the mean frequency is decreasing linearly with the parallel angle. In this far regime the stream is well ordered in energies, whilst in the near regime the stream particles have not had sufficient time to order themselves by energy. We plot the difference between the perturbed and unperturbed simulations in parallel angle for two times. The density contrast at the large negative parallel angle for the far case is very large at late times as the number density in the unperturbed simulation at these large separations is low. A similar effect is seen at large positive parallel angle for the near case but here it should be noted that we have not included the effect of more stars entering the stream as they are stripped from the progenitor. In the lower panels we show the gap size and the minimum/maximum density contrast as a function of time. The gap size in all three cases is very similar for $t<3\Gyr$ but they diverge at larger times as the far impact gap size increases faster than the near impact. We can understand this as in the far case the gap is forming on an already growing stream as the underlying stream structure is well ordered. However, in the near case the stream is mixed so the underlying stream is growing more slowly. In all cases the minimum density plateaus to a similar value. Note that we have shown two lines for the maximum density contrast for the two peaks on either side of the gap. In both the far and near cases one of the peaks diverges rapidly and correlates with the observations in the middle panels.

\begin{figure}
% $$\includegraphics[width=\columnwidth]{gap_size_planar}$$
$$\includegraphics[width=\columnwidth]{different_strike_points}$$
\caption{
Properties of the stream as a function of the location of the impact point. The top left panel shows the stream in the $(x,y)$ plane along with three dots showing the different impact points. The top right panel shows the location of these strikes in parallel angle as well as the distribution of the stream in parallel frequencies and angles. The middle two panels show the relative density contrast $\rho_\mathrm{perturbed}/\rho_\mathrm{unperturbed}-1$ in parallel angle space for two separate times. The bottom two panels show the gap size in parallel angle and the minimum and maximum density contrast as a function of time.
}
\label{varying_geometry}
\end{figure}

\section{Discussion}\label{Sect::Discussion}
THIS CAN BE PULLED INTO THE END OF THE CONCLUSIONS

\begin{enumerate}
\item What doesn't our model encompass?
\item What other sources of substructure are there?
\item Could one use this as a way to identify a gap (matched filter) or do we only bring in the big guns after the gap has been found?
\item Many smaller subhaloes?
\end{enumerate}

\section{Conclusions}\label{Sect::Conclusions}
We have presented a framework for modelling the formation of gaps due to the perturbation of a dark matter halo on a cold thin stream formed from progenitors on eccentric orbits. The formalism uses the simple description of dynamics provided by the action, angle and frequency coordinates. Stream particles obey simple equations of motion in this space which can be altered to incorporate the effects of a dark matter sub-halo. An unperturbed stream is stretched along a single direction, described by the parallel angle coordinate, in which a gap forms when the stream is impacted by a sub-halo,

We presented a simulation of a cold stream formed from a progenitor on an eccentric orbit in a scale-free flattened axisymmetric logarithmic potential. The stream was impacted by a $10^8M_\odot$ dark-matter sub-halo and a gap formed in the stream. We analysed the formation of the gap in angle-frequency space and showed how the stream at all future times could be modelled using our framework. We found that generically the angle perturbation due to a fly-by is only important on time-scales less than a radial period. At later times the frequency perturbations are much more important and are simply related to the velocity perturbations in scale-free potentials such that the structure of the gap at late times is controlled by $\bs{v}\cdot\delta\bs{v}^g$.

We computed how the gap forms in the parallel angle (the angle along the stream) and showed that the distribution in this space can be simply related to the real-space properties of the gap. The evolution of the gap in angle-frequency space can be understood in the framework presented by \cite{ErkalBelokurov2015}.

We closed by showing how the structure of the gap varies as a function of the mass of the sub-halo and the location along the stream the impact occurs. We found that, as expected, the parallel angle gap grows more slowly in time for lower mass sub-halos. The density contrast of the gap minimum plateaus to a constant value after a few $\Gyr$ for all inspected sub-halo masses but the depth of this plateau increases with mass. The more interesting result is that the growth rate of the gap depends on the location along the stream where the impact occurs. We found that near the progenitor where the particles are mixed in energy the gap grows more slowly than far from the progenitor where the particles are well ordered in energy and so the gap forms on an already growing stream.

The formalism presented promises to be crucial for constraining the properties of a sub-halo fly-by on a cold stream. DISCUSSION OF DENIS' RECENT PAPER AND HOW ONE MIGHT APPROACH CONSTRAINING A GAP??

The framework presented here is appropriate for when an interaction between the stream and a sub-halo is short compared to the orbital time of the stream such that the impulse approximation is appropriate. Instead of a full perturbative analysis we were able to simply consider instantaneous changes to the stream properties. However, it is potentially a small starting step to developing a scheme to handle more general perturbations to streams. The assumption of a smooth analytic galaxy model is probably inappropriate, particularly over the timescales on which streams evolve. \cite{Bonaca2014} presented a study of analysing streams from the Via Lactea simulation under assumptions on the smoothness of the halo and found that XXX. Additionally, recent results suggest that the mass of the LMC is much larger than previously believed. However, a counter to this is that many of the observed streams are very simple cold structures suggesting that the approximation of a smooth halo for the Milky Way is valid. Nonetheless it may be inevitable that one has to include perturbations on top of a smooth model to fit the known streams in the Galaxy and the angle-action framework is ideal for such an endeavour. These variables were originally introduced to handle perturbative solutions to the equations of the motion in the Solar system so seem highly appropriate for handling perturbations on Galactic scales.

\section*{Acknowledgements}
JLS acknowledges the support of the Science and Technology Facilities
Council.

\bibliography{bibliography}
\bibliographystyle{mn2e}

\section*{Appendix}\label{Sect::Appendix}
\subsection{Accuracy of angle, frequency and action computation}
We use the method of \cite{SandersBinney2014} to compute the actions, angles and frequencies. In this appendix we present some checks of the accuracy of the action, angle and frequency calculation as well as estimates of the errors in these quantities. In Fig.~\ref{SingleOrbitCheck} we plot the variation in the actions and frequencies as a function of time for a single orbit integrated for a long time. The errors in the actions are $\sim0.04\kpc\kms$ and the errors in the frequencies are $\sim10^{-4}\kpc^{-1}\kms$. We also plot the difference in the angles calculated at each time-step and those found from calculating $\theta_0+\Omega t$. The shaded regions shows the lines $\theta(t=0)+(\Omega\pm\Delta\Omega)t$ so there is some residual noise from the angle calculation. We subtract off the linear component to find an estimate of the error in the angles of $\sim10^{-3}\rad$. In conclusion we are satisfied that our action, frequency and angle calculation accuracy is resolving the features of the gap and stream.

\begin{figure}
$$\includegraphics[width=\columnwidth]{action_error}$$
\caption{Errors in the actions, frequencies and angles for a single orbit: the left panels show the deviation of the actions and frequencies as a function of time for a single particle taken from the simulation. The top right panel shows the difference in the angle coordinate from the value calculated using $\theta(t=0)+\Omega t$ and the bottom right panel shows the top right panel with the linear component extracted so is an estimate of the error in the angles.}
\label{SingleOrbitCheck}
\end{figure}

Another check is to evolve the simulation snapshot forward in angles and frequencies and compare the angle distribution at a later time with the angle distribution calculated from a later snapshot. We plot the histogram of the differences in the angle distributions in Fig.~\ref{TwoSnapshotCheck}. This also indicates that the error in the angle calculation is $\sim10^{-3}\rad$.

\begin{figure}
$$\includegraphics[width=\columnwidth]{ang_error}$$
\caption{Errors in the angles: histograms of the angle difference between the angles found from evolving the $880\Myr$ snapshot and those found from re-calculating the angles at the later time. The left panel shows the difference at $3\Gyr$ and the right at $5\Gyr$. Note the growth in the error with time as the errors in the frequencies are compounded with time.}
\label{TwoSnapshotCheck}
\end{figure}


\label{lastpage}
\end{document}



% \section{Stream model}
% The dynamical stream models in Sanders (2014) and Bovy (2014) are expressed in angle-frequency space: $p_{\rm st}(\boldsymbol{\Omega},\btheta)$. Here the frequencies are the derivatives of the Hamiltonian with respect to the actions $\boldsymbol{\Omega} = \upartial H/\upartial \bs{J}$. The frequency distribution is a Gaussian in two directions and a double Gaussian in the third, more extended dimension. The angle distribution is calculated from the frequency distribution under the assumption of some stripping time distribution $p(t)$. If we know that a subhalo passed through at some time $t_k$ can we design a model that reflects this?

% \section{Kick model}
% Given a set of angle-actions, how do we work out the change given an external potential? One tempting thing to do is Hamiltonian perturbation theory. We can attempt to infer the change in angles and actions from some external potential. However, I feel this overcomplicates matters. Instead we just stick with the impulse approximation of Erkal \& Belokurov (2015). In this approximation the positions $\bs{x}$ of the particles do not change over the short time the external potential acts and the velocities $\bs{v}$ change instantaneously by an amount $\delta\bs{v}$. Expressions for the change in velocity are given in Erkal \& Belokurov (2015) in a coordinate system where the stream extends along one of the coordinate axes. With these expressions we can calculate the change to the angles and actions as

% \begin{equation}
% \begin{split}
% \delta \bs{J} &= \frac{\upartial \bs{J}}{\upartial \bs{v}}\Big|_{\bs{x}}\cdot \delta\bs{v},\\
% \delta \bs{\theta} &= \frac{\upartial \bs{\theta}}{\upartial \bs{v}}\Big|_{\bs{x}}\cdot \delta\bs{v}.
% \end{split}
% \end{equation}

% I tried some generating function things to see whether these derivatives could be rewritten in some informative way but to no avail.

% Now we work out the expressions for the frequencies and angles at some time $t$ where $t>t_k$. We set $t=t_0$ to be the time at which the cluster was released.

% \begin{equation}
% \begin{split}
% \boldsymbol{\Omega} &= \boldsymbol{\Omega}'+\mat{D}\cdot\frac{\upartial \bs{J}}{\upartial \bs{v}}\Big|_{\bs{x}(t_k)}\cdot\delta\bs{v}(\bs{x}(t_k)),\\
% \bs{\theta} &= \bs{\theta}'+\Big(\mat{D}\cdot\frac{\upartial \bs{J}}{\upartial \bs{v}}\Big|_{\bs{x}(t_k)}(t-t_k)+\frac{\upartial \bs{\theta}}{\upartial \bs{v}}\Big)\cdot\delta\bs{v}(\bs{x}(t_k)).
% \end{split}
% \end{equation}
% $\mat{D}$ is the Hessian matrix. The primed quantities are the angles and frequencies if no kick had occurred. Then we can still use the stream model $p_{\rm st}(\boldsymbol{\Omega},\btheta)$ but the probability is evaluated at
% \begin{equation}
% \begin{split}
% \boldsymbol{\Omega}' &= \boldsymbol{\Omega}-\mat{D}\cdot\frac{\upartial \bs{J}}{\upartial \bs{v}}\Big|_{\bs{x}(t_k)}\cdot\delta\bs{v}(\bs{x}(t_k))=\boldsymbol{\Omega}-\bs{F},\\
% \bs{\theta}' &= \bs{\theta}-\Big(\mat{D}\cdot\frac{\upartial \bs{J}}{\upartial \bs{v}}\Big|_{\bs{x}(t_k)}(t-t_k)+\frac{\upartial \bs{\theta}}{\upartial \bs{v}}\Big)\cdot\delta\bs{v}(\bs{x}(t_k)) = \bs{\theta}-\bs{G}.
% \end{split}
% \end{equation}

% I think with these expressions we can get somewhere.

% First we posit a kick time $t_k$ and work out where the progenitor was at $t=t_k$. We then select a few points labelled $i$ along the 1D stream a la Bovy (2014) and work out the $\mat{D}_i$, $\frac{\upartial \bs{J}}{\upartial \bs{v}}\Big|_{\bs{x}_i}$ and $\frac{\upartial \btheta}{\upartial \bs{v}}\Big|_{\bs{x}_i}$. We then should rotate to a frame in which the progenitor velocity is along the $y$ direction and use the relations for the kick in this frame to find the kicks at the points $i$. We then rotate the kicks back to the original frame and calculate the changes to the angles and frequencies $\bs{F}$
%  and $\bs{G}$.

% In the neighbourhood of the true stream we use the scheme of Bovy (2014) to find the linear transformation between actions, frequencies and angles and positions and velocities for a few points to construct the stream model.

% \section{Jason and Jo differences}
% Here I am using Jo's notation for the kicks in frequency and angle and the initial and current angle and frequency separation. However, the difference between the equations seems to be the definition of the times.
% \subsection{Jason}
% $t=0$ is at some point in the past. $t=t_0$ a particle is released. $t=t_g$ particle is kicked by satellite. At the current time $t$ the particle will have a angle separation
% \begin{equation}
% \begin{split}
% \Delta\bs{\theta} &= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}(t_g-t_0)+\Delta\bs{\theta}^g+(\Delta\boldsymbol{\Omega}_{\rm init}+\Delta\boldsymbol{\Omega}^g)(t-t_g) \\&= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}(t-t_0)+\Delta\bs{\theta}^g+\Delta\boldsymbol{\Omega}^g(t-t_g).
% \end{split}
% \end{equation}
% The first two terms are as if the particle had travelled with the initial angle and frequency separation for the full time i.e. the unperturbed path (what I called $\Delta\btheta'$ before).
% \subsection{Jo}
% $t=0$ is now. Particle was released $t_s$ ago (so at $t=-t_s$) and kicked $t_g$ ago (so at $t=-t_g$). At the current time ($t=0$) particle has angle separation
% \begin{equation}
% \begin{split}
% \Delta\bs{\theta} &= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}(t_s-t_g)+\Delta\bs{\theta}^g+(\Delta\boldsymbol{\Omega}_{\rm init}+\Delta\boldsymbol{\Omega}^g)t_g \\&= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}(t_s-t_g)+\Delta\bs{\theta}^g+\Delta\boldsymbol{\Omega}t_g\\&= \Delta\bs{\theta}_{\rm init}+\Delta\boldsymbol{\Omega}_{\rm init}t_s+\Delta\bs{\theta}^g+\Delta\boldsymbol{\Omega}^g t_g.
% \end{split}
% \end{equation}
% The second equation is Jo's. The third is rewritten to look like the one above. They are the same. The difference is in the definitions of the times. Jo's definition is perhaps more natural though.

